
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Login</title>
<link rel="stylesheet" type="text/css" href="style.css" media="all" />
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript">
	function getCookieVal(cookieName) 
	{
		var allCookies = document.cookie;
		if (allCookies == null) 
		{
			console.log("is null");
		}
		var pos = allCookies.indexOf(cookieName + '=');
		if (pos == -1)
		{
			return null;
		}
		var valueStart = pos + (cookieName.length + 1);
		var valueEnd = allCookies.indexOf(";", valueStart);
		if (valueEnd == -1)
		{
			valueEnd = allCookies.length;
		}
		var value = allCookies.substring(valueStart, valueEnd);
		value = unescape(value);
		return value == "" ? null : value;
	}
	
	//not sure if we need this
	var session_id = getCookieVal("JSESSIONID"); 
	
	//im thinking we can use this so that on the client side we can know whether or not the user is logged in
	
	
	$(document).ready(function() {
		var username = getCookieVal("user");
		if(username != null)
		{
			$('#login_register').text("hello " + username);
		}
		else
		{
			$('#login_register').show();
		}
		
		// show login/register
		$('#link_login').click(function() {
			console.log("login clicked");
			$('#form_login').show();
			$('#form_register').hide();
		});

		$('#link_register').click(function() {
			console.log("register");
			$('#form_login').hide();
			$('#form_register').show();
		});
		
		$('#link_register').click(function() {
			console.log("register");
			$('#form_login').hide();
			$('#form_register').show();
		});

		// submit button action
		$('#form_login').submit(function(event) 
		{
			event.preventDefault();
			var user = $('#user_login').val();
			var passwd = $('#passwd_login').val();
			console.log(user);
			console.log(passwd);
			if (user.length == 0 || passwd.length == 0) 
			{
				$('#login_err_footnote').show();
				if (user.length == 0) {
					$('#login_username_req').show();
				}
				if (passwd.length == 0) {
					$('#login_passwd_req').show();
				}

				return;
			} 
			else 
			{
				$('#login_err_footnote').hide();
				$('#login_username_req').hide();
				$('#login_passwd_req').hide();
			}

			var settings = 
			{
				url : "login",
				type : "POST",
				data : "REQ_TYPE=LOGIN&U=" + user + "&P=" + passwd,
				success : function(responseText, statusText, jqXHR) 
				{
					//reload page, should show "hello user_name" 
					window.location.reload(true);
				},
				error : function(jqXHR, statusText, CodeText) 
				{
					$('#login_err').show();
				}
			};
			jQuery.ajax(settings);
		});

		$('#form_register').submit(function(event) 
		{
			event.preventDefault();
			var user = $('#register_user_login').val();
			var passwd = $('#register_passwd_login').val();
			console.log(user);
			console.log(passwd);
			if (user.length == 0 || passwd.length == 0) {
				$('#register_err_footnote').show();
				if (user.length == 0) {
					$('#register_username_req').show();
				}
				if (passwd.length == 0) {
					$('#register_passwd_req').show();
				}

				return;
			} else {
				$('#register_err_footnote').hide();
				$('#register_username_req').hide();
				$('#register_passwd_req').hide();
			}

			var settings = {
				url : "login",
				type : "POST",
				data : "REQ_TYPE=REGISTER&U=" + user + "&P=" + passwd,
				success : function(responseText, statusText, jqXHR) {
					//should redirect to 
					window.location.pathname = "soup/foo.html";
				},
				error : function(jqXHR, statusText, CodeText) {
					$('#register_err').show();
				}
			};
			jQuery.ajax(settings);
		});
		
		$('#form_upload').submit(function(event) 
		{
			var filename = $('#file_chooser').val();
			console.log(filename);
			if(filename.length == 0)
			{
				$('#no_file_err').show();
				return;
			}
			else
			{
				$('#no_file_err').hide();
			}
			
			
			});
		return;
	});
</script>
</head>
<body id="main_body">
	<div id="nav_bar">
		<h1>
				<a id="login_register" style="color: blue; font-weight: bolder;">Login/Register</a>
				<div id="upload">Upload</div>
		</h1>
	</div>
	<div id="form_container">
		<form id="form_login" class="appnitro">
			<div class="form_description">
				<h2>Login</h2>
				<p>
					Login if you already have an account or <a id="link_register"
						style="color: blue; font-weight: bolder;">register</a> a new
					account.
				</p>
			</div>
			<ul>
				<li id="li_1"><label class="description" for="user_login">Username
						<a id="login_username_req"
						style="color: red; font-weight: bolder; display: none;">*</a>
				</label>
					<div>
						<input id="user_login" name="U" class="element text medium"
							type="text" maxlength="255" value="" />
					</div></li>
				<li id="li_2"><label class="description" for="passwd_login">Password
						<a id="login_passwd_req"
						style="color: red; font-weight: bolder; display: none;">*</a>
				</label>
					<div>
						<input id="passwd_login" name="P" class="element text medium"
							type="password" maxlength="255" value="" />
					</div></li>
				<li class="buttons">
					<div id="login_err"
						style="display: none; color: red; font-weight: bolder;">Invalid
						login information :(</div>
					<div id="login_err_footnote"
						style="display: none; color: red; font-weight: bolder;">* =
						Required</div> <input class="button_text" type="submit" value="login" />
				</li>
			</ul>
		</form>

		<form id="form_register" class="appnitro" style="display: none">
			<div class="form_description">
				<h2>Register</h2>
				<p>
					Create a new account or <a id="link_login"
						style="color: blue; font-weight: bolder;">login</a> if you already
					have one.
				</p>
			</div>
			<ul>
				<li id="li_1"><label class="description"
					for="register_user_login">Username <a
						id="register_username_req"
						style="color: red; font-weight: bolder; display: none;">*</a></label>
					<div>
						<input id="register_user_login" name="U"
							class="element text medium" type="text" maxlength="255" value="" />
					</div></li>
				<li id="li_2"><label class="description"
					for="register_passwd_login">Password <a
						id="register_passwd_req"
						style="color: red; font-weight: bolder; display: none;">*</a></label>
					<div>
						<input id="register_passwd_login" name="P"
							class="element text medium" type="password" maxlength="255"
							value="" />
					</div></li>
				<li class="buttons">
					<div id="register_err"
						style="display: none; color: red; font-weight: bolder;">Username
						is already taken :(</div>
					<div id="register_err_footnote"
						style="display: none; color: red; font-weight: bolder;">* =
						Required</div> <input class="button_text" type="submit" value="register" />
				</li>
			</ul>
		</form>
		
		<form id="form_upload" class="appnitro" enctype="multipart/form-data" action="upload" method="post" style="display:none">
			<div class="form_description">
				<h2>Image Upload</h2>
				<p>Please choose an image to upload.</p>
			</div>
			<ul>
				<li id="li_1">
					<div>
						<input id="file_chooser" type="file" name="imgfile"/>
					</div>
				</li>
				<li class="buttons">
					<div id="invalid_ext_err" style="display: none; color: red; font-weight: bolder;">Please choose a file with one of the following extensions: jpg, jpeg, gif, png, bmp</div>
					<div id="no_file_err" style="display: none; color: red; font-weight: bolder;">Please choose a file!</div>
					<div id="upload_success" style="display: none; color: red; font-weight: bolder;">file uploaded!</div>
					<input class="button_text" type="submit"/>
				</li>
			</ul>
		</form>
	</div>
</body>
</html>